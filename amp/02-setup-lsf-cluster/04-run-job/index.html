<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.96.0"><meta name=description content="HPC on IBM Cloud Tutorials"><link rel="shortcut icon" href=https://ibm.github.io/ibmcloud-hpc-tutorials/images/favicon.png type=image/x-icon><title>Run LSF Jobs Using Auto-Scaling :: HPC on IBM Cloud Tutorials</title><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/nucleus.css?1648750782 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/fontawesome-all.min.css?1648750782 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/hybrid.css?1648750782 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/featherlight.min.css?1648750782 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/perfect-scrollbar.min.css?1648750782 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/auto-complete.css?1648750782 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/atom-one-dark-reasonable.css?1648750782 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/theme.css?1648750782 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/tabs.css?1648750782 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/hugo-theme.css?1648750782 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/theme-ibm.css?1648750782 rel=stylesheet><script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/jquery-3.3.1.min.js?1648750782></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=https://ibm.github.io/ibmcloud-hpc-tutorials/amp/02-setup-lsf-cluster/04-run-job/><nav id=sidebar><div id=header-wrapper><div id=header><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/ title="Go home"><img id=preview-image src=https://ibm.github.io/ibmcloud-hpc-tutorials/images/IBM_Cloud_Lockup_v1.png crossorigin=anonymous style=border-width:0 width=800><a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/lunr.min.js?1648750782></script>
<script type=text/javascript src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/auto-complete.js?1648750782></script>
<script type=text/javascript>var baseurl="https://ibm.github.io/ibmcloud-hpc-tutorials/"</script><script type=text/javascript src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/search.js?1648750782></script></div><section id=homelinks><ul><li><a class=padding href=https://ibm.github.io/ibmcloud-hpc-tutorials/><i class="fas fa-home"></i> Home</a></li></ul></section><div class=highlightable><ul class=topics><li data-nav-id=/01-hpc-overview/ title="HPC on Cloud Overview" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/01-hpc-overview/><b>I ⁃ </b>HPC on Cloud Overview</a></li><li data-nav-id=/02-setup-lsf-cluster/ title="Standing up an LSF Cluster" class="dd-item
parent"><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/02-setup-lsf-cluster/><b>II ⁃ </b>Standing up an LSF Cluster</a><ul><li data-nav-id=/amp/02-setup-lsf-cluster/01-sshkey-api/ title="Prepare SSH and API Keys" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/amp/02-setup-lsf-cluster/01-sshkey-api/>Prepare SSH and API Keys</a></li><li data-nav-id=/amp/02-setup-lsf-cluster/02-hpc-cluster-catalog/ title="Create Your Cluster using IBM Spectrum LSF automation package" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/amp/02-setup-lsf-cluster/02-hpc-cluster-catalog/>Create Your Cluster using IBM Spectrum LSF automation package</a></li><li data-nav-id=/amp/02-setup-lsf-cluster/03-access-cluster/ title="Access Your Cluster" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/amp/02-setup-lsf-cluster/03-access-cluster/>Access Your Cluster</a></li><li data-nav-id=/amp/02-setup-lsf-cluster/04-run-job/ title="Run LSF Jobs Using Auto-Scaling" class="dd-item active"><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/amp/02-setup-lsf-cluster/04-run-job/>Run LSF Jobs Using Auto-Scaling</a></li><li data-nav-id=/amp/02-setup-lsf-cluster/05-manage-cluster/ title="Manage your Cluster" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/amp/02-setup-lsf-cluster/05-manage-cluster/>Manage your Cluster</a></li></ul></li><li data-nav-id=/03-bursting/ title="Cloud Bursting" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/03-bursting/><b>III ⁃ </b>Cloud Bursting</a><ul><li data-nav-id=/amp/03-bursting/01-onprem_cluster/ title="Emulate an on-premise cluster" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/amp/03-bursting/01-onprem_cluster/>Emulate an on-premise cluster</a></li><li data-nav-id=/amp/03-bursting/02-onprem-vpn/ title="Set up VPN for the on-premise cluster" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/amp/03-bursting/02-onprem-vpn/>Set up VPN for the on-premise cluster</a></li><li data-nav-id=/amp/03-bursting/03-cloud_cluster_step/ title="Create a second cluster and establish VPN connection" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/amp/03-bursting/03-cloud_cluster_step/>Create a second cluster and establish VPN connection</a></li><li data-nav-id=/amp/03-bursting/04-multicluster/ title="Set up LSF multi-cluster and job forwarding" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/amp/03-bursting/04-multicluster/>Set up LSF multi-cluster and job forwarding</a></li></ul></li><li data-nav-id=/04-custom-image/ title="Custom Image (Under Construction)" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/04-custom-image/><b>IV ⁃ </b>Custom Image (Under Construction)</a><ul><li data-nav-id=/amp/04-custom-image/01-create-vsi-from-default-lsf-image/ title="Create VSI From Default LSF Image" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/amp/04-custom-image/01-create-vsi-from-default-lsf-image/>Create VSI From Default LSF Image</a></li><li data-nav-id=/amp/04-custom-image/02-customize-software-on-the-vsi/ title="Customize Software on the VSI" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/amp/04-custom-image/02-customize-software-on-the-vsi/>Customize Software on the VSI</a></li><li data-nav-id=/amp/04-custom-image/03-create-image-from-customized-volume/ title="Create Image From Customized Volume" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/amp/04-custom-image/03-create-image-from-customized-volume/>Create Image From Customized Volume</a></li><li data-nav-id=/amp/04-custom-image/04-create-cluster-from-custom-image/ title="Create Cluster From Custom Image" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/amp/04-custom-image/04-create-cluster-from-custom-image/>Create Cluster From Custom Image</a></li></ul></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://github.com/IBM/ibmcloud-hpc-tutorials><i class="fab fa-github"></i> Github</a></li><li><a class=padding href=https://www.ibm.com/cloud/hpc><i class="fas fa-bookmark"></i> IBM Cloud HPC</a></li><li><a class=padding href=https://ibm.github.io/ibmcloud-hpc-tutorials/authors/><i class="fas fa-users"></i> Authors</a></li><li><a class=padding href=https://github.com/IBM/ibmcloud-hpc-tutorials/issues><i class="fas fa-envelope"></i> Feedback / Questions?</a></li><li><a class=padding href=https://ibm.github.io/ibmcloud-hpc-tutorials/tags><i class="fas fa-tags"></i> Tags</a></li></ul></section><section id=footer><left><br><a href=https://www.ibm.com/privacy>Privacy</a> | <a href=https://www.ibm.com/support/customer/csol/terms/>Site Terms</a> | © 2022, IBM Corp. or its affiliates. All rights reserved.</left></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=top-github-link><a class=github-link title="Edit this page" href=https://github.com/IBM/ibmcloud-hpc-tutorials/tree/main/content/02-setup-lsf-cluster/04-run-job.md target=blank><i class="fas fa-code-branch"></i>
<span id=top-github-link-text>Edit this page</span></a></div><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/amp/>HPC on IBM Cloud Tutorials</a> > <a href=https://ibm.github.io/ibmcloud-hpc-tutorials/02-setup-lsf-cluster/>Standing up an LSF Cluster</a> > Run LSF Jobs Using Auto-Scaling</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><ul><li><a href=#more-information-about-lsf>More information about LSF</a></li></ul></li></ul></nav></div></div></div></div><div id=head-tags><div class=tags><a class=tag-link href=https://ibm.github.io/ibmcloud-hpc-tutorials/tags/lsf>LSF</a></div></div><div id=body-inner><h1>Run LSF Jobs Using Auto-Scaling</h1><p><em>worker_node_max_count</em> and _worker_node_min_count are the parameters for you to configure auto-scaling.</p><figure class=img-sm><img src=https://ibm.github.io/ibmcloud-hpc-tutorials/images/setup-lsf-cluster/autoscaling_param.png alt=lsf_param_scale></figure><p>If you leave <em>worker_node_max_count</em> and _worker_node_min_count parameters with default values, you currently would have no worker node in your cluster.</p><p>In the example below, icgen2host-10-242-64-37 is the only node in your LSF cluser and is served as the LSF management node which is configured not to run users&rsquo; workloads.</p><pre tabindex=0><code class=language-shell/bash data-lang=shell/bash>[lsfadmin@icgen2host-10-242-64-37 ~]$ bhosts -w
HOST_NAME          STATUS          JL/U    MAX  NJOBS    RUN  SSUSP  USUSP    RSV 
icgen2host-10-242-64-37 closed_Full     -      0      0      0      0      0      0
</code></pre><p>In addition, since the <em>worker_node_max_count</em> parameter is set to 10, you can only submit jobs that use no more than 10 nodes.
Here, we submit a simple sleep job by requesting 2 worker nodes and observe how auto-scaling works behind the scene to dynamically
provision two nodes and add to the existing cluster.</p><pre tabindex=0><code class=language-shell/bash data-lang=shell/bash>[lsfadmin@icgen2host-10-242-64-37 ~]$ bsub -n 2 -R &#34;span[ptile=1]&#34; sleep 10
Job &lt;3&gt; is submitted to default queue &lt;normal&gt;.
</code></pre><p>Wait for few minutes. Run <em>bhosts</em> again and you will see two new worker nodes added to the cluster by auto-scaling.</p><pre tabindex=0><code class=language-shell/bash data-lang=shell/bash>[lsfadmin@icgen2host-10-242-64-37 ~]$ bhosts -w
HOST_NAME          STATUS          JL/U    MAX  NJOBS    RUN  SSUSP  USUSP    RSV 
icgen2host-10-242-64-37 closed_Full     -      0      0      0      0      0      0
icgen2host-10-242-64-38 ok              -      4      0      0      0      0      0
icgen2host-10-242-64-40 ok              -      4      0      0      0      0      0
</code></pre><p>The submitted job is shown as completed running the sleep command on these two new nodes.</p><pre tabindex=0><code class=language-shell/bash data-lang=shell/bash>[lsfadmin@icgen2host-10-242-64-37 ~]$ bjobs -a -w
JOBID   USER    STAT  QUEUE      FROM_HOST               EXEC_HOST     JOB_NAME   SUBMIT_TIME
3       lsfadmin DONE  normal    icgen2host-10-242-64-37 icgen2host-10-242-64-38:icgen2host-10-242-64-40 sleep 10   Dec  7 11:55
                                                         icgen2host-10-242-64-40
</code></pre><p>After the new nodes have been idling for 10 minutes, auto-scaling will destroy the resources and have those removed from your cluster.</p><p>Now let&rsquo;s run a simple MPI job. Go to /home/lsfadmin/shared and this is the directory which is visible to all nodes in your cluster.
Threfore, you should place your MPI workloads under this directory. OpenMPI 4.1 is already installed under /usr/local/openmpi-4.1.0
and you can include its bin/ directory to your PATH environment variable.</p><pre tabindex=0><code class=language-shell/bash data-lang=shell/bash>lsfadmin@icgen2host-10-242-64-37:~&gt;cd shared/
lsfadmin@icgen2host-10-242-64-37:~/shared&gt;pwd
/home/lsfadmin/shared

lsfadmin@icgen2host-10-242-64-37:~/shared&gt; export PATH=/usr/local/openmpi-4.1.0/bin:$PATH
lsfadmin@icgen2host-10-242-64-37:~/shared&gt;which mpicc
/usr/local/openmpi-4.1.0/bin/mpicc
</code></pre><p>Let&rsquo;s create a MPI program named hello.c and build it using mpicc from OpenMPI 4.1.</p><pre tabindex=0><code>lsfadmin@icgen2host-10-242-64-37:~/shared&gt;cat &gt; hello.c &lt;&lt; EOF
&gt; #include &lt;mpi.h&gt;
&gt; #include &lt;stdio.h&gt;
&gt; #include &lt;stdlib.h&gt;
&gt; #include &lt;unistd.h&gt;
&gt; 
&gt; int main(int argc, char *argv[])
&gt; {
&gt;   int myrank;
&gt;   char hostname[50];
&gt; 
&gt;   gethostname(hostname, 50);
&gt;   printf(&#34;Hello from %s (before MPI_Init)...\n&#34;, hostname);
&gt; 
&gt;   MPI_Init(&amp;argc, &amp;argv);
&gt;   //sleep(600);
&gt;   MPI_Comm_rank(MPI_COMM_WORLD, &amp;myrank);
&gt;   printf(&#34;Hello from %s, rank %d...\n&#34;, hostname, myrank);
&gt; 
&gt;   MPI_Finalize();
&gt; 
&gt;   return 0;
&gt; }
&gt; EOF
lsfadmin@icgen2host-10-242-64-37:~/shared&gt;mpicc -g -o hello hello.c
</code></pre><p>We now run a MPI job with 4 MPI tasks on two nodes, each node with 2 MPI ranks.</p><pre tabindex=0><code class=language-shell/bash data-lang=shell/bash>lsfadmin@icgen2host-10-242-64-37:~/shared&gt;bsub -o %J.out -e %J.err -n 4 -R &#34;span[ptile=2]&#34; mpirun ./hello
Job &lt;5&gt; is submitted to default queue &lt;normal&gt;.
</code></pre><p>Check the 5.out file:</p><pre tabindex=0><code class=language-shell/bash data-lang=shell/bash>lsfadmin@icgen2host-10-242-64-37:~/shared&gt;cat 5.out 
Sender: LSF System &lt;lsfadmin@icgen2host-10-242-64-38&gt;
Subject: Job 5: &lt;mpirun ./hello&gt; in cluster &lt;HPCCluster&gt; Done

Job &lt;mpirun ./hello&gt; was submitted from host &lt;icgen2host-10-242-64-37&gt; by user &lt;lsfadmin&gt; in cluster &lt;HPCCluster&gt; at Tue Dec  7 13:43:30 2021
Job was executed on host(s) &lt;2*icgen2host-10-242-64-38&gt;, in queue &lt;normal&gt;, as user &lt;lsfadmin&gt; in cluster &lt;HPCCluster&gt; at Tue Dec  7 13:45:28 2021
                            &lt;2*icgen2host-10-242-64-43&gt;
&lt;/home/lsfadmin&gt; was used as the home directory.
&lt;/home/lsfadmin/shared&gt; was used as the working directory.
Started at Tue Dec  7 13:45:28 2021
Terminated at Tue Dec  7 13:45:30 2021
Results reported at Tue Dec  7 13:45:30 2021

Your job looked like:

------------------------------------------------------------
# LSBATCH: User input
mpirun ./hello
------------------------------------------------------------

Successfully completed.

Resource usage summary:

    CPU time :                                   0.27 sec.
    Max Memory :                                 -
    Average Memory :                             -
    Total Requested Memory :                     -
    Delta Memory :                               -
    Max Swap :                                   -
    Max Processes :                              -
    Max Threads :                                -
    Run time :                                   4 sec.
    Turnaround time :                            120 sec.

The output (if any) follows:

Hello from icgen2host-10-242-64-38 (before MPI_Init)...
Hello from icgen2host-10-242-64-38 (before MPI_Init)...
Hello from icgen2host-10-242-64-43 (before MPI_Init)...
Hello from icgen2host-10-242-64-43 (before MPI_Init)...
Hello from icgen2host-10-242-64-38, rank 0...
Hello from icgen2host-10-242-64-38, rank 1...
Hello from icgen2host-10-242-64-43, rank 2...
Hello from icgen2host-10-242-64-43, rank 3...


PS:

Read file &lt;5.err&gt; for stderr output of this job.
</code></pre><h3 id=more-information-about-lsf>More information about LSF</h3><p>You can learn more about LSF <a href="https://www.ibm.com/docs/en/spectrum-lsf/10.1.0?topic=best-practices-tips">here</a>.</p><p>Below is a cheat sheet for useful LSF commands:</p><figure class=img-md><img src=https://ibm.github.io/ibmcloud-hpc-tutorials/images/setup-lsf-cluster/lsf_commands.png alt=LSF></figure><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=https://ibm.github.io/ibmcloud-hpc-tutorials/amp/02-setup-lsf-cluster/03-access-cluster/ title="Access Your Cluster"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=https://ibm.github.io/ibmcloud-hpc-tutorials/amp/02-setup-lsf-cluster/05-manage-cluster/ title="Manage your Cluster" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/clipboard.min.js?1648750782></script>
<script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/perfect-scrollbar.min.js?1648750782></script>
<script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/perfect-scrollbar.jquery.min.js?1648750782></script>
<script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/jquery.sticky.js?1648750782></script>
<script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/featherlight.min.js?1648750782></script>
<script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/highlight.pack.js?1648750782></script>
<script>hljs.initHighlightingOnLoad()</script><script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/modernizr.custom-3.6.0.js?1648750782></script>
<script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/learn.js?1648750782></script>
<script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/hugo-learn.js?1648750782></script>
<script src=https://ibm.github.io/ibmcloud-hpc-tutorials/mermaid/mermaid.js?1648750782></script>
<script>mermaid.initialize({startOnLoad:!0})</script></body></html>