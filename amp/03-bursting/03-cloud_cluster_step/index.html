<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.96.0"><meta name=description content="HPC on IBM Cloud Tutorials"><link rel="shortcut icon" href=https://ibm.github.io/ibmcloud-hpc-tutorials/images/favicon.png type=image/x-icon><title>Create a second cluster and establish VPN connection :: HPC on IBM Cloud Tutorials</title><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/nucleus.css?1648750782 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/fontawesome-all.min.css?1648750782 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/hybrid.css?1648750782 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/featherlight.min.css?1648750782 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/perfect-scrollbar.min.css?1648750782 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/auto-complete.css?1648750782 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/atom-one-dark-reasonable.css?1648750782 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/theme.css?1648750782 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/tabs.css?1648750782 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/hugo-theme.css?1648750782 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/theme-ibm.css?1648750782 rel=stylesheet><script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/jquery-3.3.1.min.js?1648750782></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=https://ibm.github.io/ibmcloud-hpc-tutorials/amp/03-bursting/03-cloud_cluster_step/><nav id=sidebar><div id=header-wrapper><div id=header><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/ title="Go home"><img id=preview-image src=https://ibm.github.io/ibmcloud-hpc-tutorials/images/IBM_Cloud_Lockup_v1.png crossorigin=anonymous style=border-width:0 width=800><a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/lunr.min.js?1648750782></script>
<script type=text/javascript src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/auto-complete.js?1648750782></script>
<script type=text/javascript>var baseurl="https://ibm.github.io/ibmcloud-hpc-tutorials/"</script><script type=text/javascript src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/search.js?1648750782></script></div><section id=homelinks><ul><li><a class=padding href=https://ibm.github.io/ibmcloud-hpc-tutorials/><i class="fas fa-home"></i> Home</a></li></ul></section><div class=highlightable><ul class=topics><li data-nav-id=/01-hpc-overview/ title="HPC on Cloud Overview" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/01-hpc-overview/><b>I ⁃ </b>HPC on Cloud Overview</a></li><li data-nav-id=/02-setup-lsf-cluster/ title="Standing up an LSF Cluster" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/02-setup-lsf-cluster/><b>II ⁃ </b>Standing up an LSF Cluster</a><ul><li data-nav-id=/amp/02-setup-lsf-cluster/01-sshkey-api/ title="Prepare SSH and API Keys" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/amp/02-setup-lsf-cluster/01-sshkey-api/>Prepare SSH and API Keys</a></li><li data-nav-id=/amp/02-setup-lsf-cluster/02-hpc-cluster-catalog/ title="Create Your Cluster using IBM Spectrum LSF automation package" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/amp/02-setup-lsf-cluster/02-hpc-cluster-catalog/>Create Your Cluster using IBM Spectrum LSF automation package</a></li><li data-nav-id=/amp/02-setup-lsf-cluster/03-access-cluster/ title="Access Your Cluster" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/amp/02-setup-lsf-cluster/03-access-cluster/>Access Your Cluster</a></li><li data-nav-id=/amp/02-setup-lsf-cluster/04-run-job/ title="Run LSF Jobs Using Auto-Scaling" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/amp/02-setup-lsf-cluster/04-run-job/>Run LSF Jobs Using Auto-Scaling</a></li><li data-nav-id=/amp/02-setup-lsf-cluster/05-manage-cluster/ title="Manage your Cluster" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/amp/02-setup-lsf-cluster/05-manage-cluster/>Manage your Cluster</a></li></ul></li><li data-nav-id=/03-bursting/ title="Cloud Bursting" class="dd-item
parent"><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/03-bursting/><b>III ⁃ </b>Cloud Bursting</a><ul><li data-nav-id=/amp/03-bursting/01-onprem_cluster/ title="Emulate an on-premise cluster" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/amp/03-bursting/01-onprem_cluster/>Emulate an on-premise cluster</a></li><li data-nav-id=/amp/03-bursting/02-onprem-vpn/ title="Set up VPN for the on-premise cluster" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/amp/03-bursting/02-onprem-vpn/>Set up VPN for the on-premise cluster</a></li><li data-nav-id=/amp/03-bursting/03-cloud_cluster_step/ title="Create a second cluster and establish VPN connection" class="dd-item active"><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/amp/03-bursting/03-cloud_cluster_step/>Create a second cluster and establish VPN connection</a></li><li data-nav-id=/amp/03-bursting/04-multicluster/ title="Set up LSF multi-cluster and job forwarding" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/amp/03-bursting/04-multicluster/>Set up LSF multi-cluster and job forwarding</a></li></ul></li><li data-nav-id=/04-custom-image/ title="Custom Image (Under Construction)" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/04-custom-image/><b>IV ⁃ </b>Custom Image (Under Construction)</a><ul><li data-nav-id=/amp/04-custom-image/01-create-vsi-from-default-lsf-image/ title="Create VSI From Default LSF Image" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/amp/04-custom-image/01-create-vsi-from-default-lsf-image/>Create VSI From Default LSF Image</a></li><li data-nav-id=/amp/04-custom-image/02-customize-software-on-the-vsi/ title="Customize Software on the VSI" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/amp/04-custom-image/02-customize-software-on-the-vsi/>Customize Software on the VSI</a></li><li data-nav-id=/amp/04-custom-image/03-create-image-from-customized-volume/ title="Create Image From Customized Volume" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/amp/04-custom-image/03-create-image-from-customized-volume/>Create Image From Customized Volume</a></li><li data-nav-id=/amp/04-custom-image/04-create-cluster-from-custom-image/ title="Create Cluster From Custom Image" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/amp/04-custom-image/04-create-cluster-from-custom-image/>Create Cluster From Custom Image</a></li></ul></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://github.com/IBM/ibmcloud-hpc-tutorials><i class="fab fa-github"></i> Github</a></li><li><a class=padding href=https://www.ibm.com/cloud/hpc><i class="fas fa-bookmark"></i> IBM Cloud HPC</a></li><li><a class=padding href=https://ibm.github.io/ibmcloud-hpc-tutorials/authors/><i class="fas fa-users"></i> Authors</a></li><li><a class=padding href=https://github.com/IBM/ibmcloud-hpc-tutorials/issues><i class="fas fa-envelope"></i> Feedback / Questions?</a></li><li><a class=padding href=https://ibm.github.io/ibmcloud-hpc-tutorials/tags><i class="fas fa-tags"></i> Tags</a></li></ul></section><section id=footer><left><br><a href=https://www.ibm.com/privacy>Privacy</a> | <a href=https://www.ibm.com/support/customer/csol/terms/>Site Terms</a> | © 2022, IBM Corp. or its affiliates. All rights reserved.</left></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=top-github-link><a class=github-link title="Edit this page" href=https://github.com/IBM/ibmcloud-hpc-tutorials/tree/main/content/03-bursting/03-cloud_cluster_step.md target=blank><i class="fas fa-code-branch"></i>
<span id=top-github-link-text>Edit this page</span></a></div><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/amp/>HPC on IBM Cloud Tutorials</a> > <a href=https://ibm.github.io/ibmcloud-hpc-tutorials/03-bursting/>Cloud Bursting</a> > Create a second cluster and establish VPN connection</span></div><div class=progress><div class=wrapper><nav id=TableOfContents></nav></div></div></div></div><div id=head-tags><div class=tags><a class=tag-link href=https://ibm.github.io/ibmcloud-hpc-tutorials/tags/cloud-bursting>Cloud bursting</a></div></div><div id=body-inner><h1>Create a second cluster and establish VPN connection</h1><p>We can now proceed to create the new cluster (&ldquo;HPCCluster&rdquo;) as the cloud
bursting target in the US-East region (Washington DC). Using the LSF tile, the
process is mostly identical as before, but with the following specific
parameters:</p><ul><li>Region (all occurances): us-east</li><li>Zone: us-east-3</li><li>vpc_name: leave empty</li><li>vpn_enabled: true</li><li>vpn_peer_address: OnPremCluster&rsquo;s VPN gateway IP</li><li>vpn_peer_cidrs: OnPremCluster&rsquo;s CIDR</li><li>vpn_preshared_key: any string of user&rsquo;s choice, to be used again in VPN connection</li><li>management_node_count=1</li><li>worker_node_min_count=2</li><li>worker_node_max_count=2</li></ul><p>Once all the resources are created, take note of the jump host and management
node addresses. Head to the VPN section and find its corresponding VPN&rsquo;s
gateway IP and CIDR. Also we need to make sure HPCCluster&rsquo;s VPN is enabled.</p><p>Suppose we end up with the following setup from the two clusters:</p><table><thead><tr><th></th><th>OnPremCluster</th><th>HPCCluster</th></tr></thead><tbody><tr><td>Management node</td><td>icgen2host-10-240-128-21 (10.240.128.21)</td><td>icgen2host-10-240-128-21 (10.241.128.21)</td></tr><tr><td>VPN gateway</td><td>52.118.79.73</td><td>150.239.220.255</td></tr><tr><td>CIDR</td><td>10.240.128.0/18</td><td>10.241.128.0/18</td></tr><tr><td>Preshared key</td><td>n/a</td><td>lfsclustervpn</td></tr></tbody></table><p>The next step is to establish the VPN connection from OnPremCluster VPN. As
shown below, &ldquo;Local&rdquo; corresponds to OnPremCluster and &ldquo;Peer&rdquo; corresponds to
HPCCluster. The same &ldquo;preshared key&rdquo; used for creating the HPCCluster&rsquo;s VPN
must be used.</p><figure class=img-md><img src=https://ibm.github.io/ibmcloud-hpc-tutorials/images/bursting/vpn-conn.png alt=vpn-conn></figure><p>Upon creation, it take about a minute before the VPN connection becomes active, as shown below:</p><figure class=img-ty><img src=https://ibm.github.io/ibmcloud-hpc-tutorials/images/bursting/vpn-conn-active.png alt=vpn-conn-active></figure><p>Unlike HPCCluster&rsquo;s subnet, OnPremCluster&rsquo;s subnet is not created without
an attached VPN. Its UDP ports 500 and 4500 must be manually made
accessible from outside. This is done by creating an open inbound rule in
OnPremCluster&rsquo;s attached security group, as shown below:</p><figure class=img-lg><img src=https://ibm.github.io/ibmcloud-hpc-tutorials/images/bursting/onpremvpn-rule.png alt=onpremvpn-rule></figure><p>We also need to modify <code>/etc/hosts</code> on the management node on both cluster, so that the hostnames for the LSF masters are DNS-resolvable.
On OnPremCluster:</p><pre tabindex=0><code>...
10.240.128.21 icgen2host-10-240-128-21
...
10.241.128.21 icgen2host-10-241-128-21  # added
</code></pre><p>On HPCCluster:</p><pre tabindex=0><code>...
10.241.128.21 icgen2host-10-241-128-21
...
10.240.128.21 icgen2host-10-240-128-21  # added
</code></pre><p>To confirm VPN connection from OnPremCluster:</p><pre tabindex=0><code>[lsfadmin@icgen2host-10-240-128-21 ~]$ ping icgen2host-10-241-128-21
PING icgen2host-10-241-128-21 (10.241.128.21) 56(84) bytes of data.
64 bytes from icgen2host-10-241-128-21 (10.241.128.21): icmp_seq=1 ttl=62 time=33.1 ms
...
</code></pre><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=https://ibm.github.io/ibmcloud-hpc-tutorials/amp/03-bursting/02-onprem-vpn/ title="Set up VPN for the on-premise cluster"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=https://ibm.github.io/ibmcloud-hpc-tutorials/amp/03-bursting/04-multicluster/ title="Set up LSF multi-cluster and job forwarding" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/clipboard.min.js?1648750782></script>
<script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/perfect-scrollbar.min.js?1648750782></script>
<script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/perfect-scrollbar.jquery.min.js?1648750782></script>
<script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/jquery.sticky.js?1648750782></script>
<script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/featherlight.min.js?1648750782></script>
<script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/highlight.pack.js?1648750782></script>
<script>hljs.initHighlightingOnLoad()</script><script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/modernizr.custom-3.6.0.js?1648750782></script>
<script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/learn.js?1648750782></script>
<script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/hugo-learn.js?1648750782></script>
<script src=https://ibm.github.io/ibmcloud-hpc-tutorials/mermaid/mermaid.js?1648750782></script>
<script>mermaid.initialize({startOnLoad:!0})</script></body></html>