<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.96.0"><meta name=description content="HPC on IBM Cloud Tutorials"><link rel="shortcut icon" href=https://ibm.github.io/ibmcloud-hpc-tutorials/images/favicon.png type=image/x-icon><title>Set up LSF multi-cluster and job forwarding :: HPC on IBM Cloud Tutorials</title><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/nucleus.css?1648866939 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/fontawesome-all.min.css?1648866939 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/hybrid.css?1648866939 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/featherlight.min.css?1648866939 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/perfect-scrollbar.min.css?1648866939 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/auto-complete.css?1648866939 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/atom-one-dark-reasonable.css?1648866939 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/theme.css?1648866939 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/tabs.css?1648866939 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/hugo-theme.css?1648866939 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/theme-ibm.css?1648866939 rel=stylesheet><script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/jquery-3.3.1.min.js?1648866939></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=https://ibm.github.io/ibmcloud-hpc-tutorials/03-bursting/04-multicluster/><nav id=sidebar><div id=header-wrapper><div id=header><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/ title="Go home"><img id=preview-image src=https://ibm.github.io/ibmcloud-hpc-tutorials/images/IBM_Cloud_Lockup_v1.png crossorigin=anonymous style=border-width:0 width=800><a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/lunr.min.js?1648866939></script>
<script type=text/javascript src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/auto-complete.js?1648866939></script>
<script type=text/javascript>var baseurl="https://ibm.github.io/ibmcloud-hpc-tutorials/"</script><script type=text/javascript src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/search.js?1648866939></script></div><section id=homelinks><ul><li><a class=padding href=https://ibm.github.io/ibmcloud-hpc-tutorials/><i class="fas fa-home"></i> Home</a></li></ul></section><div class=highlightable><ul class=topics><li data-nav-id=/01-hpc-overview/ title="HPC on Cloud Overview" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/01-hpc-overview/><b>I ⁃ </b>HPC on Cloud Overview</a></li><li data-nav-id=/02-setup-lsf-cluster/ title="Standing up an LSF Cluster" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/02-setup-lsf-cluster/><b>II ⁃ </b>Standing up an LSF Cluster</a><ul><li data-nav-id=/02-setup-lsf-cluster/01-sshkey-api/ title="Prepare SSH and API Keys" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/02-setup-lsf-cluster/01-sshkey-api/>Prepare SSH and API Keys</a></li><li data-nav-id=/02-setup-lsf-cluster/02-hpc-cluster-catalog/ title="Create Your Cluster using IBM Spectrum LSF automation package" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/02-setup-lsf-cluster/02-hpc-cluster-catalog/>Create Your Cluster using IBM Spectrum LSF automation package</a></li><li data-nav-id=/02-setup-lsf-cluster/03-access-cluster/ title="Access Your Cluster" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/02-setup-lsf-cluster/03-access-cluster/>Access Your Cluster</a></li><li data-nav-id=/02-setup-lsf-cluster/04-run-job/ title="Run LSF Jobs Using Auto-Scaling" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/02-setup-lsf-cluster/04-run-job/>Run LSF Jobs Using Auto-Scaling</a></li><li data-nav-id=/02-setup-lsf-cluster/05-manage-cluster/ title="Manage your Cluster" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/02-setup-lsf-cluster/05-manage-cluster/>Manage your Cluster</a></li></ul></li><li data-nav-id=/03-bursting/ title="Cloud Bursting" class="dd-item
parent"><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/03-bursting/><b>III ⁃ </b>Cloud Bursting</a><ul><li data-nav-id=/03-bursting/01-onprem_cluster/ title="Emulate an on-premise cluster" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/03-bursting/01-onprem_cluster/>Emulate an on-premise cluster</a></li><li data-nav-id=/03-bursting/02-onprem-vpn/ title="Set up VPN for the on-premise cluster" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/03-bursting/02-onprem-vpn/>Set up VPN for the on-premise cluster</a></li><li data-nav-id=/03-bursting/03-cloud_cluster_step/ title="Create a second cluster and establish VPN connection" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/03-bursting/03-cloud_cluster_step/>Create a second cluster and establish VPN connection</a></li><li data-nav-id=/03-bursting/04-multicluster/ title="Set up LSF multi-cluster and job forwarding" class="dd-item active"><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/03-bursting/04-multicluster/>Set up LSF multi-cluster and job forwarding</a></li></ul></li><li data-nav-id=/04-custom-image/ title="Custom Image (Under Construction)" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/04-custom-image/><b>IV ⁃ </b>Custom Image (Under Construction)</a><ul><li data-nav-id=/04-custom-image/01-create-vsi-from-default-lsf-image/ title="Create VSI From Default LSF Image" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/04-custom-image/01-create-vsi-from-default-lsf-image/>Create VSI From Default LSF Image</a></li><li data-nav-id=/04-custom-image/02-customize-software-on-the-vsi/ title="Customize Software on the VSI" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/04-custom-image/02-customize-software-on-the-vsi/>Customize Software on the VSI</a></li><li data-nav-id=/04-custom-image/03-create-image-from-customized-volume/ title="Create Image From Customized Volume" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/04-custom-image/03-create-image-from-customized-volume/>Create Image From Customized Volume</a></li><li data-nav-id=/04-custom-image/04-create-cluster-from-custom-image/ title="Create Cluster From Custom Image" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/04-custom-image/04-create-cluster-from-custom-image/>Create Cluster From Custom Image</a></li></ul></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://github.com/IBM/ibmcloud-hpc-tutorials><i class="fab fa-github"></i> Github</a></li><li><a class=padding href=https://www.ibm.com/cloud/hpc><i class="fas fa-bookmark"></i> IBM Cloud HPC</a></li><li><a class=padding href=https://ibm.github.io/ibmcloud-hpc-tutorials/authors/><i class="fas fa-users"></i> Authors</a></li><li><a class=padding href=https://github.com/IBM/ibmcloud-hpc-tutorials/issues><i class="fas fa-envelope"></i> Feedback / Questions?</a></li><li><a class=padding href=https://ibm.github.io/ibmcloud-hpc-tutorials/tags><i class="fas fa-tags"></i> Tags</a></li></ul></section><section id=footer><left><br><a href=https://www.ibm.com/privacy>Privacy</a> | <a href=https://www.ibm.com/support/customer/csol/terms/>Site Terms</a> | © 2022, IBM Corp. or its affiliates. All rights reserved.</left></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=top-github-link><a class=github-link title="Edit this page" href=https://github.com/IBM/ibmcloud-hpc-tutorials/tree/main/content/03-bursting/04-multicluster.md target=blank><i class="fas fa-code-branch"></i>
<span id=top-github-link-text>Edit this page</span></a></div><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/>HPC on IBM Cloud Tutorials</a> > <a href=https://ibm.github.io/ibmcloud-hpc-tutorials/03-bursting/>Cloud Bursting</a> > Set up LSF multi-cluster and job forwarding</span></div><div class=progress><div class=wrapper><nav id=TableOfContents></nav></div></div></div></div><div id=head-tags><div class=tags><a class=tag-link href=https://ibm.github.io/ibmcloud-hpc-tutorials/tags/cloud-bursting>Cloud bursting</a></div></div><div id=body-inner><h1>Set up LSF multi-cluster and job forwarding</h1><p>We now proceed to set up the LSF multi-cluster and job forwarding. Both
clusters need to recognize each other, so you need to modify
<code>/opt/ibm/lsf/conf/lsf.shared</code>. This configuration file should be identical in
both clusters.</p><pre tabindex=0><code>...
Begin Cluster
ClusterName Servers
HPCCluster icgen2host-10-241-128-21
OnPremCluster icgen2host-10-240-128-21
End Cluster
...
</code></pre><p>The two clusters are configured to have different <code>lsb.queues</code> files. In the
HPCCluster, you need to append the following lines to
<code>/opt/ibm/lsf/conf/lsbatch/HPCCluster/configdir/lsb.queues</code> to register a
receive queue:</p><pre tabindex=0><code>...
Begin Queue
QUEUE_NAME=recv_q
RCVJOBS_FROM=OnPremCluster
PRIORITY=30
NICE=20
RC_HOSTS=all
End Queue
...
</code></pre><p>OnPremCluster is configured to have a send queue at <code>/opt/ibm/lsf/conf/lsbatch/OnPremiseCluster/configdir/lsb.queues</code>:</p><pre tabindex=0><code>...
Begin Queue
QUEUE_NAME=send_q
SNDJOBS_TO=recv_q@allclusters
PRIORITY=30
NICE=20
End Queue
...
</code></pre><p>Restart both clusters by running the following command:</p><pre tabindex=0><code>$ lsfrestart
</code></pre><p>Check if two clusters are connected</p><pre tabindex=0><code>[lsfadmin@icgen2host-10-240-128-21 ~]$ lsclusters -w
CLUSTER_NAME   STATUS   MASTER_HOST                     ADMIN    HOSTS  SERVERS
OnPremCluster  ok       icgen2host-10-240-128-21     lsfadmin        3        3
HPCCluster     ok       icgen2host-10-241-128-21     lsfadmin        3        3
</code></pre><p>Now you can forward jobs from OnPremCluster to HPCCluster. If we submit
20 concurrent <code>sleep 10s</code> jobs, some of the jobs will be scheduled on HPCCluster:</p><pre tabindex=0><code>$ for i in `seq 1 20`; do bsub -q send_q sleep 10s; done
</code></pre><p>after a few seconds:</p><pre tabindex=0><code>[lsfadmin@icgen2host-10-240-128-21 ~]$ bjobs -w
JOBID   USER    STAT  QUEUE      FROM_HOST   EXEC_HOST   JOB_NAME   SUBMIT_TIME
397     lsfadmin RUN   send_q     icgen2host-10-240-128-21 icgen2host-10-240-128-23 sleep 10s  Mar 30 21:25
398     lsfadmin RUN   send_q     icgen2host-10-240-128-21 icgen2host-10-240-128-23 sleep 10s  Mar 30 21:25
399     lsfadmin RUN   send_q     icgen2host-10-240-128-21 icgen2host-10-240-128-23 sleep 10s  Mar 30 21:25
400     lsfadmin RUN   send_q     icgen2host-10-240-128-21 icgen2host-10-240-128-23 sleep 10s  Mar 30 21:25
401     lsfadmin RUN   send_q     icgen2host-10-240-128-21 icgen2host-10-240-128-22 sleep 10s  Mar 30 21:25
402     lsfadmin RUN   send_q     icgen2host-10-240-128-21 icgen2host-10-240-128-22 sleep 10s  Mar 30 21:25
403     lsfadmin RUN   send_q     icgen2host-10-240-128-21 icgen2host-10-240-128-22 sleep 10s  Mar 30 21:25
404     lsfadmin RUN   send_q     icgen2host-10-240-128-21 icgen2host-10-240-128-22 sleep 10s  Mar 30 21:25
405     lsfadmin RUN   send_q     icgen2host-10-240-128-21 icgen2host-10-241-128-23@HPCCluster sleep 10s  Mar 30 21:25
406     lsfadmin RUN   send_q     icgen2host-10-240-128-21 icgen2host-10-241-128-23@HPCCluster sleep 10s  Mar 30 21:25
407     lsfadmin RUN   send_q     icgen2host-10-240-128-21 icgen2host-10-241-128-23@HPCCluster sleep 10s  Mar 30 21:25
408     lsfadmin RUN   send_q     icgen2host-10-240-128-21 icgen2host-10-241-128-23@HPCCluster sleep 10s  Mar 30 21:25
409     lsfadmin RUN   send_q     icgen2host-10-240-128-21 icgen2host-10-241-128-22@HPCCluster sleep 10s  Mar 30 21:25
410     lsfadmin RUN   send_q     icgen2host-10-240-128-21 icgen2host-10-241-128-22@HPCCluster sleep 10s  Mar 30 21:25
411     lsfadmin RUN   send_q     icgen2host-10-240-128-21 icgen2host-10-241-128-22@HPCCluster sleep 10s  Mar 30 21:25
412     lsfadmin RUN   send_q     icgen2host-10-240-128-21 icgen2host-10-241-128-22@HPCCluster sleep 10s  Mar 30 21:25
413     lsfadmin PEND  send_q     icgen2host-10-240-128-21    -        sleep 10s  Mar 30 21:25
414     lsfadmin PEND  send_q     icgen2host-10-240-128-21    -        sleep 10s  Mar 30 21:25
415     lsfadmin PEND  send_q     icgen2host-10-240-128-21    -        sleep 10s  Mar 30 21:25
416     lsfadmin PEND  send_q     icgen2host-10-240-128-21    -        sleep 10s  Mar 30 21:25
</code></pre><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=https://ibm.github.io/ibmcloud-hpc-tutorials/03-bursting/03-cloud_cluster_step/ title="Create a second cluster and establish VPN connection"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=https://ibm.github.io/ibmcloud-hpc-tutorials/04-custom-image/ title="Custom Image (Under Construction)" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/clipboard.min.js?1648866939></script>
<script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/perfect-scrollbar.min.js?1648866939></script>
<script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/perfect-scrollbar.jquery.min.js?1648866939></script>
<script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/jquery.sticky.js?1648866939></script>
<script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/featherlight.min.js?1648866939></script>
<script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/highlight.pack.js?1648866939></script>
<script>hljs.initHighlightingOnLoad()</script><script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/modernizr.custom-3.6.0.js?1648866939></script>
<script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/learn.js?1648866939></script>
<script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/hugo-learn.js?1648866939></script>
<script src=https://ibm.github.io/ibmcloud-hpc-tutorials/mermaid/mermaid.js?1648866939></script>
<script>mermaid.initialize({startOnLoad:!0})</script></body></html>