<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.95.0"><meta name=description content="HPC on IBM Cloud Tutorials"><link rel="shortcut icon" href=https://ibm.github.io/ibmcloud-hpc-tutorials/images/favicon.png type=image/x-icon><title>Set up VPN :: HPC on IBM Cloud Tutorials</title><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/nucleus.css?1648003501 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/fontawesome-all.min.css?1648003501 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/hybrid.css?1648003501 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/featherlight.min.css?1648003501 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/perfect-scrollbar.min.css?1648003501 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/auto-complete.css?1648003501 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/atom-one-dark-reasonable.css?1648003501 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/theme.css?1648003501 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/tabs.css?1648003501 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/hugo-theme.css?1648003501 rel=stylesheet><link href=https://ibm.github.io/ibmcloud-hpc-tutorials/css/theme-ibm.css?1648003501 rel=stylesheet><script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/jquery-3.3.1.min.js?1648003501></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=https://ibm.github.io/ibmcloud-hpc-tutorials/03-bursting/01-vpn/><nav id=sidebar><div id=header-wrapper><div id=header><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/ title="Go home"><img id=preview-image src=https://ibm.github.io/ibmcloud-hpc-tutorials/images/IBM_Cloud_Lockup_v1.png crossorigin=anonymous style=border-width:0 width=800><a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/lunr.min.js?1648003501></script>
<script type=text/javascript src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/auto-complete.js?1648003501></script>
<script type=text/javascript>var baseurl="https://ibm.github.io/ibmcloud-hpc-tutorials/"</script><script type=text/javascript src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/search.js?1648003501></script></div><section id=homelinks><ul><li><a class=padding href=https://ibm.github.io/ibmcloud-hpc-tutorials/><i class="fas fa-home"></i> Home</a></li></ul></section><div class=highlightable><ul class=topics><li data-nav-id=/01-hpc-overview/ title="HPC on Cloud Overview" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/01-hpc-overview/><b>I ⁃ </b>HPC on Cloud Overview</a></li><li data-nav-id=/02-setup-lsf-cluster/ title="Standing up an LSF Cluster" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/02-setup-lsf-cluster/><b>II ⁃ </b>Standing up an LSF Cluster</a><ul><li data-nav-id=/02-setup-lsf-cluster/01-sshkey-api/ title="Prepare SSH and API Keys" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/02-setup-lsf-cluster/01-sshkey-api/>Prepare SSH and API Keys</a></li><li data-nav-id=/02-setup-lsf-cluster/02-hpc-cluster-catalog/ title="Create Your Cluster using IBM Spectrum LSF" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/02-setup-lsf-cluster/02-hpc-cluster-catalog/>Create Your Cluster using IBM Spectrum LSF</a></li><li data-nav-id=/02-setup-lsf-cluster/03-access-cluster/ title="Access Your Cluster" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/02-setup-lsf-cluster/03-access-cluster/>Access Your Cluster</a></li><li data-nav-id=/02-setup-lsf-cluster/04-run-job/ title="Run LSF Jobs Using Auto-Scaling" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/02-setup-lsf-cluster/04-run-job/>Run LSF Jobs Using Auto-Scaling</a></li><li data-nav-id=/02-setup-lsf-cluster/05-manage-cluster/ title="Manage your Cluster" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/02-setup-lsf-cluster/05-manage-cluster/>Manage your Cluster</a></li></ul></li><li data-nav-id=/03-bursting/ title="Cloud Bursting" class="dd-item
parent"><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/03-bursting/><b>III ⁃ </b>Cloud Bursting</a><ul><li data-nav-id=/03-bursting/01-vpn/ title="Set up VPN" class="dd-item active"><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/03-bursting/01-vpn/>Set up VPN</a></li><li data-nav-id=/03-bursting/02-setup/ title="Set up multi-cluster and job forwarding" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/03-bursting/02-setup/>Set up multi-cluster and job forwarding</a></li><li data-nav-id=/03-bursting/03-tryout/ title="Try cloud bursting" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/03-bursting/03-tryout/>Try cloud bursting</a></li></ul></li><li data-nav-id=/04-custom-image/ title="Custom Image" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/04-custom-image/><b>IV ⁃ </b>Custom Image</a><ul><li data-nav-id=/04-custom-image/01-create-vsi-from-default-lsf-image/ title="Create VSI From Default LSF Image" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/04-custom-image/01-create-vsi-from-default-lsf-image/>Create VSI From Default LSF Image</a></li><li data-nav-id=/04-custom-image/02-customize-software-on-the-vsi/ title="Customize Software on the VSI" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/04-custom-image/02-customize-software-on-the-vsi/>Customize Software on the VSI</a></li><li data-nav-id=/04-custom-image/03-create-image-from-customized-volume/ title="Create Image From Customized Volume" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/04-custom-image/03-create-image-from-customized-volume/>Create Image From Customized Volume</a></li><li data-nav-id=/04-custom-image/04-create-cluster-from-custom-image/ title="Create Cluster From Custom Image" class=dd-item><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/04-custom-image/04-create-cluster-from-custom-image/>Create Cluster From Custom Image</a></li></ul></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://github.com/IBM/ibmcloud-hpc-tutorials><i class="fab fa-github"></i> Github</a></li><li><a class=padding href=https://www.ibm.com/cloud/hpc><i class="fas fa-bookmark"></i> IBM Cloud HPC</a></li><li><a class=padding href=https://ibm.github.io/ibmcloud-hpc-tutorials/authors.html><i class="fas fa-users"></i> Authors</a></li><li><a class=padding href=https://github.com/IBM/ibmcloud-hpc-tutorials/issues><i class="fas fa-envelope"></i> Feedback / Questions?</a></li><li><a class=padding href=https://ibm.github.io/tags><i class="fas fa-tags"></i> Tags</a></li></ul></section><section id=footer><left><a class=github-button href=https://github.ibm.com/hybrid-cloud-infrastructure-research/hpc_ibmcloud_tutorial data-icon=octicon-star data-show-count=true aria-label="Star on GitHub">Star</a>
<a class=github-button href=https://github.ibm.com/hybrid-cloud-infrastructure-research/hpc_ibmcloud_tutorial data-icon=octicon-repo-forked data-show-count=true aria-label="Fork on GitHub">Fork</a><br><a href=https://www.ibm.com/privacy>Privacy</a> | <a href=https://www.ibm.com/support/customer/csol/terms/>Site Terms</a> | © 2022, IBM Corp. or its affiliates. All rights reserved.</left>
<script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=top-github-link><a class=github-link title="Edit this page" href=https://github.com/IBM/ibmcloud-hpc-tutorials03-bursting/01-vpn.md target=blank><i class="fas fa-code-branch"></i>
<span id=top-github-link-text>Edit this page</span></a></div><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=https://ibm.github.io/ibmcloud-hpc-tutorials/>HPC on IBM Cloud Tutorials</a> > <a href=https://ibm.github.io/ibmcloud-hpc-tutorials/03-bursting/>Cloud Bursting</a> > Set up VPN</span></div><div class=progress><div class=wrapper><nav id=TableOfContents></nav></div></div></div></div><div id=head-tags><div class=tags><a class=tag-link href=https://ibm.github.io/ibmcloud-hpc-tutorials/tags/burst>burst</a></div></div><div id=body-inner><h1>Set up VPN</h1><p>The automation package is implemented as a Terraform template for VPCs on IBM Cloud. Users can configure and start their cluster creation with Schematics, a Terraform platform with Web UI on IBM Cloud. The template is publicly available at <a href=https://github.com/IBM-Cloud/hpc-cluster-lsf>GitHub for IBM Cloud</a>. All you need to create a cloud HPC cluster is to set the GitHub link to a Schematics workspace, edit pre-defined variables, and click several buttons. This tutorial gives a step-by-step guide to creating an example VPN deployment.</p><p>Before you begin, make sure to complete the first four steps for <a href="https://cloud.ibm.com/docs/ibm-spectrum-lsf?topic=ibm-spectrum-lsf-getting-started-tutorial">getting started with IBM Spectrum LSF</a>. Also, you need to know the public IP address of your local VPN server, a local CIDR accessing the VPN environment, and a preshared key to authenticate your VPN connection. The preshared key can be any random string.</p><p>The following figure is an example of a VPN deployment.</p><figure><img src=https://ibm.github.io/ibmcloud-hpc-tutorials/images/bursting/hpcc_vpn-diagram.png alt=vpn width=1024></figure><p>This example links a VPN gateway to the subnet for LSF nodes. By doing this, local clients can directly access them with private IP addresses (for example, 192.168.3.21 to 10.248.0.37).</p><ol><li><p>Configure VPN deployment variables</p><p>Set VPN deployment variables when you <a href="https://cloud.ibm.com/docs/ibm-spectrum-lsf?topic=ibm-spectrum-lsf-creating-workspace">create your workspace</a>. In addition to essential variables to construct your cluster (e.g., <code>api_key</code>), you need to set <code>vpn_enabled</code> to be <code>true</code>, and then, specify <code>vpn_peer_address</code>, <code>vpn_peer_cidrs</code>, and <code>vpn_preshared_key</code> to be identical to the public IP address for your local VPN server, a local CIDR accessing to the VPN environment, and a preshared key, respectively. In the case of the above example architecture, set <code>vpn_peer_address</code> to be <code>60.150.xxx.yyy</code>, and <code>vpn_peer_cidrs</code> to be <code>192.168.3.0/24</code>.</p></li><li><p>Apply plan</p><p><a href="https://ibm.github.io/ibmcloud-hpc-tutorials/docs/ibm-spectrum-lsf?topic=ibm-spectrum-lsf-applying-plan">Apply a plan</a> to build your cluster with a VPN gateway. After a while, Schematics logs show you essential information to configure your local VPN environment. You can use the Web console to check the log files. They show a line <code>vpn_config_info =...</code>, which contains the VPN public IP (<code>162.133.aaa.bbb</code>), the connected CIDR (<code>10.248.0.32/27</code>), and used UDP ports.</p><pre tabindex=0><code>2021/10/07 04:06:48 Terraform apply | Outputs:
2021/10/07 04:06:48 Terraform apply | 
2021/10/07 04:06:48 Terraform apply | ssh_command = &#34;ssh -J root@163.68.xxx.yyy  lsfadmin@10.248.0.37&#34;
2021/10/07 04:06:48 Terraform apply | vpc_name = &#34;lsf-cloud-vpc --  - r034-3cdad0f9-42b6-4ce3-b1c5-61c9f3b55cfa&#34;
2021/10/07 04:06:48 Terraform apply | vpn_config_info = &#34;IP: 163.68.aaa.bbb, CIDR: 10.248.0.32/27, UDP ports: 500, 4500&#34;
2021/10/07 04:06:48 Command finished successfully.
2021/10/07 04:06:53 Done with the workspace action
</code></pre></li><li><p>Configure your local VPN environment</p><p>Typical VPN configurations require a public IP address for the local VPN server, a local CIDR, a preshared key, a peer IP address, and a peer CIDR. In the example above, you first need to configure your local VPN server with public IP address, local CIDR, and a preshared key, which are identical to what you specified for <code>vpn_peer_address</code>, <code>vpn_peer_cidr</code>, and <code>vpn_preshared_key</code> at Step 1, respectively. Then, your local VPN configuration needs to add a peer IP address to be <code>163.68.aaa.bbb</code> and a peer CIDR to be <code>10.248.0.32/27</code> according to the output of Step 2. Finally, UDP ports 500 and 4500 must be accessible from the VPN gateway on IBM Cloud by configuring your local network devices (e.g., routers). For more details on configuring your VPN, see <a href="https://ibm.github.io/ibmcloud-hpc-tutorials/docs/vpc?topic=vpc-vpn-onprem-example">Connecting to your on-premises network</a>.</p></li></ol><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=https://ibm.github.io/ibmcloud-hpc-tutorials/03-bursting/ title="Cloud Bursting"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=https://ibm.github.io/ibmcloud-hpc-tutorials/03-bursting/02-setup/ title="Set up multi-cluster and job forwarding" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/clipboard.min.js?1648003501></script>
<script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/perfect-scrollbar.min.js?1648003501></script>
<script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/perfect-scrollbar.jquery.min.js?1648003501></script>
<script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/jquery.sticky.js?1648003501></script>
<script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/featherlight.min.js?1648003501></script>
<script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/highlight.pack.js?1648003501></script>
<script>hljs.initHighlightingOnLoad()</script><script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/modernizr.custom-3.6.0.js?1648003501></script>
<script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/learn.js?1648003501></script>
<script src=https://ibm.github.io/ibmcloud-hpc-tutorials/js/hugo-learn.js?1648003501></script>
<script src=https://ibm.github.io/ibmcloud-hpc-tutorials/mermaid/mermaid.js?1648003501></script>
<script>mermaid.initialize({startOnLoad:!0})</script></body></html>